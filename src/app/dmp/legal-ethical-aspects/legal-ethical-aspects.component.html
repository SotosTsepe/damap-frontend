<h2>Legal aspects</h2>
<p>This step helps you to consider issues like personal data, intellectual property rights and ownership.</p>
<div [formGroup]="legalEthicalStep">

  <!-- Yes/No Questions-->
  <div *ngFor="let question of questions">
    <mat-label>{{question.label}}</mat-label>
    <mat-radio-group formControlName="{{question.model}}">
      <mat-radio-button class="boolean-mat-radio-button" [value]="true">Yes
      </mat-radio-button>
      <mat-radio-button class="boolean-mat-radio-button" [value]="false">No
      </mat-radio-button>
    </mat-radio-group>

    <!--Personal Data-->
    <ng-container *ngIf="question.model === 'personalData' && legalEthicalStep?.value.personalData && datasets?.length">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets containing personal data:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="personalData">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
      <div>
        <mat-form-field appearance="fill" [style]="'width: 100%'">
          <mat-label>How will compliance with applicable legislation be ensured?</mat-label>
          <mat-select formControlName="personalDataCompliance" multiple>
            <mat-option *ngFor="let option of complianceOptions | keyvalue: originalOrder" [value]="option.value">
              {{option.value}}
            </mat-option>
          </mat-select>
          <mat-hint>Make sure you follow the TU Wien guidance on informed consent.</mat-hint>
        </mat-form-field>
        <br><br>
        <ng-container *ngIf="isOtherSelected">
          <app-input-wrapper [label]="'Please specify what other measures are taken:'"
                             [control]="otherPersonalDataCompliance"
                             [appearance]="'fill'"></app-input-wrapper>
        </ng-container>
      </div>
    </ng-container>

    <!--Sensitive Data-->
    <ng-container
      *ngIf="question.model === 'sensitiveData' && legalEthicalStep?.value.sensitiveData && datasets?.length">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets containing sensitive data:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="sensitiveData">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
      <div>
        <mat-form-field appearance="fill" [style]="'width: 100%'">
          <mat-label>What kind of additional security measures in terms of physical security, network security, and
            security of computer systems and files will be taken to ensure that stored and transferred sensitive data is
            safe?
          </mat-label>
          <mat-select formControlName="sensitiveDataSecurity" multiple>
            <mat-option *ngFor="let option of securityOptions | keyvalue: originalOrder" [value]="option.value">
              {{option.value}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <ng-container *ngIf="isOtherMeasureSelected">
          <app-input-wrapper [label]="'Please specify what other measures are taken:'"
                             [control]="otherDataSecurityMeasures"
                             [appearance]="'fill'"></app-input-wrapper>
        </ng-container>
        <app-input-wrapper [label]="'Who will be authorised to access sensitive data?'"
                           [control]="sensitiveDataAccess"
                           [appearance]="'fill'"></app-input-wrapper>
      </div>
    </ng-container>

    <!--Legal Restrictions-->
    <ng-container
      *ngIf="question.model === 'legalRestrictions' && legalEthicalStep?.value.legalRestrictions && datasets?.length">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets concerned:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="legalRestrictions">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
      <div>
        <app-input-wrapper [label]="'Please specify the legal restrictions:'" [appearance]="'fill'"
                           [control]="legalRestrictionsComment"></app-input-wrapper>
      </div>
      <mat-form-field appearance="fill" [style]="'width: 100%'">
        <mat-label>In which document(s) are these restrictions specified?</mat-label>
        <mat-select formControlName="legalRestrictionsDocuments" multiple>
          <mat-option *ngFor="let option of agreementOptions | keyvalue: originalOrder" [value]="option.value">
            {{option.value}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <ng-container *ngIf="isOtherDocumentSelected">
        <app-input-wrapper [label]="'Please specify the other documents:'"
                           [appearance]="'fill'" [control]="otherLegalRestrictionsDocuments"></app-input-wrapper>
      </ng-container>
      <app-input-wrapper [label]="'Who has rights to the produced data and who controls access to the data?'"
                         [appearance]="'fill'" [control]="dataRightsAndAccessControl"></app-input-wrapper>
    </ng-container>
  </div>
</div>

<app-ethical-aspects [legalEthicalStep]="legalEthicalStep"></app-ethical-aspects>
