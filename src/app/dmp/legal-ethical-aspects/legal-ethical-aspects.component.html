<p>This step helps you to consider issues like personal data, intellectual property rights and ownership.</p>
<div [formGroup]="legalEthicalStep">
  <div *ngFor="let question of questions">
    <mat-label>{{question.label}}</mat-label>
    <mat-radio-group formControlName="{{question.model}}">
      <mat-radio-button class="boolean-mat-radio-button" [value]="true">Yes
      </mat-radio-button>
      <mat-radio-button class="boolean-mat-radio-button" [value]="false">No
      </mat-radio-button>
    </mat-radio-group>
    <ng-container *ngIf="question.model === 'personalData' && legalEthicalStep?.value.personalData && datasets?.length">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets containing personal data:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="personalData">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
      <div>
        <mat-form-field appearance="fill" [style]="'width: 100%'">
          <mat-label>How will compliance with applicable legislation be ensured?</mat-label>
          <mat-select formControlName="personalDataCompliance" multiple>
            <mat-option *ngFor="let option of complianceOptions | keyvalue: originalOrder" [value]="option.value">
              {{option.value}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <ng-container *ngIf="isOtherSelected">
          <mat-form-field appearance="fill" [style]="'width: 100%'">
            <mat-label [style]="'white-space: normal;'">
              Please specify what other measures are taken.
            </mat-label>
            <input matInput formControlName="otherPersonalDataCompliance">
          </mat-form-field>
        </ng-container>
      </div>
      <mat-form-field appearance="fill" [style]="'width: 100%'">
        <mat-label [style]="'white-space: normal;'">
          How will you ensure that only authorised users can access personal data?
        </mat-label>
        <textarea matInput formControlName="personalDataAccess"></textarea>
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="question.model === 'sensitiveData' && legalEthicalStep?.value.sensitiveData && datasets?.length">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets containing sensitive data:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="sensitiveData">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
      <mat-form-field appearance="fill" [style]="'width: 100%'">
        <mat-label [style]="'white-space: normal;'">
          What kind of additional security measures in terms of physical security,
          network security, and security of computer systems and files will be taken
          to ensure that stored and transferred sensitive data is safe?
        </mat-label>
        <textarea matInput formControlName="sensitiveDataSecurity"></textarea>
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="question.model === 'legalRestrictions' && legalEthicalStep?.value.legalRestrictions">
      <div>
        <section class="dataset-checkbox-section" [formGroup]="dmpForm">
          Please select the datasets concerned:
          <div formArrayName="datasets">
            <ng-container *ngFor="let dataset of datasets?.controls; index as i">
              <ng-container [formGroupName]="i">
                <mat-checkbox class="dataset-checkbox"
                              formControlName="legalRestrictions">{{dataset.value.title}}</mat-checkbox>
              </ng-container>
            </ng-container>
          </div>
        </section>
      </div>
    </ng-container>
    <ng-container *ngIf="question.model === 'ethicalIssues' && legalEthicalStep?.value.ethicalIssues">
      <mat-radio-group formControlName="committeeApproved">
        <mat-label>Was your plan to deal with these ethical issues approved by the ethics committee?</mat-label>
        <mat-radio-button class="boolean-mat-radio-button" [value]="true">Yes
        </mat-radio-button>
        <mat-radio-button class="boolean-mat-radio-button" [value]="false">No
        </mat-radio-button>
      </mat-radio-group>
      <mat-form-field *ngIf="legalEthicalStep?.value.committeeApproved"
                      appearance="fill" [style]="'width:100%'">
        <mat-label>Links to ethics report or related documents:</mat-label>
        <textarea matInput formControlName="ethicsReport"></textarea>
      </mat-form-field>
    </ng-container>
  </div>

  <mat-form-field appearance="fill" [style]="'width:100%'">
    <mat-label>Other statement regarding ethical compliance (optional):</mat-label>
    <textarea matInput formControlName="optionalStatement"></textarea>
  </mat-form-field>
</div>
