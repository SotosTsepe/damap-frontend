<app-save-status [saved]="!formChanged"></app-save-status>
<mat-vertical-stepper [linear]="false" (selectionChange)="changeStep($event)">
  <mat-step label="{{'dmp.steps.project.label' | translate }}">
    <app-dmp-project [projects]="projects$ | async"
                     [loaded]="projectsLoaded$ | async"
                     [projectStep]="projectStep"
                     (project)="changeProject($event)"></app-dmp-project>
  </mat-step>
  <mat-step label="{{'dmp.steps.people.label' | translate }}">
    <app-dmp-people [projectMembers]="projectMembers"
                    [contactStep]="contactStep"
                    [contributorStep]="contributorStep"
                    (contactPerson)="changeContactPerson($event)"
                    (contributorToAdd)="addContributor($event)"
                    (contributorToRemove)="removeContributor($event)">
    </app-dmp-people>
  </mat-step>
  <mat-step label="{{'dmp.steps.data.specify.label' | translate }}">
    <app-dmp-specify-data [specifyDataStep]="specifyDataStep"
                          [datasets]="datasets"
                          [fileUpload]="fileUpload"
                          (createDataset)="addDataset($event)"
                          (updateDataset)="updateDataset($event)"
                          (fileToAnalyse)="analyseFile($event)"
                          (uploadToCancel)="cancelFileUpload($event)"
                          (removeDataset)="removeDataset($event)">
    </app-dmp-specify-data>
  </mat-step>
  <mat-step label="{{'dmp.steps.documentation.label' | translate }}">
    <app-dmp-doc-data-quality [docDataStep]="docDataStep"></app-dmp-doc-data-quality>
  </mat-step>
  <mat-step label="{{'dmp.steps.storage.label' | translate }}">
    <ng-container *ngIf="specifyDataStep.value.kind === 'SPECIFY' && datasets.length else noDatasets">
      <app-step-intro>This step helps you to document who is allowed to see or edit your data in the project phase and
        to find good storage and backup solutions for your data.
      </app-step-intro>
      <app-data-access [dmpForm]="dmpForm"
                       [datasets]="datasets"></app-data-access>
      <app-dmp-storage [dmpForm]="dmpForm"
                       [storageStep]="storageStep"
                       [datasets]="datasets"
                       (storageToAdd)="addStorage($event)"
                       (storageToRemove)="removeStorage($event)">
      </app-dmp-storage>
      <app-dmp-external-storage [externalStorageStep]="externalStorageStep"
                                [externalStorageInfo]="externalStorageInfo"
                                [datasets]="datasets"
                                (externalStorageToAdd)="addExternalStorage()"
                                (externalStorageToRemove)="removeExternalStorage($event)">
      </app-dmp-external-storage>
    </ng-container>
  </mat-step>

  <mat-step label="{{'dmp.steps.legal.label' | translate }}">
    <ng-container *ngIf="specifyDataStep.value.kind === 'SPECIFY' && datasets.length else noDatasets">
      <app-dmp-legal-ethical-aspects [dmpForm]="dmpForm"
                                     [legalEthicalStep]="legalEthicalStep"
                                     [datasets]="datasets">
      </app-dmp-legal-ethical-aspects>
    </ng-container>
  </mat-step>
  <mat-step label="{{'dmp.steps.licensing.label' | translate }}">
    <ng-container *ngIf="specifyDataStep.value.kind === 'SPECIFY' && datasets.length else noDatasets">
      <app-dmp-licenses [dmpForm]="dmpForm"
                        [datasets]="datasets">
      </app-dmp-licenses>
    </ng-container>
  </mat-step>
  <mat-step label="{{'dmp.steps.repositories.label' | translate }}">
    <ng-container *ngIf="specifyDataStep.value.kind === 'SPECIFY' && datasets.length else noDatasets">
      <app-dmp-repo [repoStep]="repoStep" [datasets]="datasets"
                    [loaded]="repositoriesLoaded$ | async"
                    [repositories]="repositories$ | async"
                    (repositoryToAdd)="addRepository($event)"
                    (repositoryToRemove)="removeRepository($event)"
                    (repositoryDetails)="getRepositoryDetails($event)">
      </app-dmp-repo>
    </ng-container>
  </mat-step>
  <mat-step label="{{'dmp.steps.data.reuse.label' | translate }}">
    <app-dmp-reuse [reuseStep]="reuseStep"
                   [datasets]="datasets">
    </app-dmp-reuse>
  </mat-step>
  <mat-step label="{{'dmp.steps.costs.label' | translate }}">
    <app-dmp-costs [costsStep]="costsStep"
                   (costToAdd)="addCost()"
                   (costToRemove)="removeCost($event)">
    </app-dmp-costs>
  </mat-step>
  <mat-step label="{{'dmp.steps.end.label' | translate }}">
    <app-dmp-summary></app-dmp-summary>
  </mat-step>
</mat-vertical-stepper>
<div id="save-dmp">
  <button mat-button color="primary" [routerLink]="'/plans'"
          routerLinkActive="active">{{'button.discard' | translate }}</button>
  <button mat-raised-button color="primary" (click)="saveDmp()"
          [disabled]="dmpForm.invalid">{{'button.save' | translate }}</button>
</div>

<ng-template #noDatasets>
  {{'dmp.nodatasets' | translate }}
</ng-template>
